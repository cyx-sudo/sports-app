# 数据库配置说明

## 数据库类型
**better-sqlite3** (基于 SQLite)

## 数据库特性
- **类型**: 文件型数据库（SQLite）
- **文件位置**: `backend/data/sports_app.db`
- **无需服务器**: SQLite 是嵌入式数据库，不需要独立的数据库服务器
- **零配置**: 应用启动时自动连接和初始化

## 生产环境配置

### 数据库连接
```typescript
// backend/src/service/database.service.ts
const dbPath = path.join(__dirname, '../../data/sports_app.db');
this.db = new Database(dbPath);
```

### 连接参数
- **主机**: 不适用（文件型数据库）
- **端口**: 不适用（文件型数据库）
- **用户名**: 不适用（无需认证）
- **密码**: 不适用（无需认证）
- **数据库文件**: `sports_app.db`

## 数据库表结构

### 核心表
1. **users** - 用户信息表
2. **activities** - 活动信息表
3. **bookings** - 预约记录表
4. **favorites** - 收藏记录表
5. **activity_history** - 活动历史表

### 外键关系
- `bookings.user_id` → `users.id`
- `bookings.activity_id` → `activities.id`
- `favorites.user_id` → `users.id`
- `favorites.activity_id` → `activities.id`
- `activity_history.user_id` → `users.id`
- `activity_history.activity_id` → `activities.id`

## 部署说明

### 1. 文件部署
- 将整个 `deployment/` 目录部署到服务器
- 确保 `sports_app.db` 文件包含在部署包中
- 数据库文件具有适当的读写权限

### 2. 数据持久化
- SQLite 数据存储在 `sports_app.db` 文件中
- 备份：复制数据库文件即可
- 恢复：替换数据库文件即可

### 3. 性能特点
- 适合中小型应用（< 100万条记录）
- 读写性能优秀
- 事务支持完整
- 并发读取性能好

## 数据库管理

### 查看数据
```bash
# 使用 sqlite3 命令行工具
sqlite3 sports_app.db

# 查看表结构
.schema

# 查看数据
SELECT * FROM users;
SELECT * FROM activities;
SELECT * FROM bookings;
```

### 备份数据
```bash
# 简单备份
cp sports_app.db sports_app_backup.db

# 导出 SQL
sqlite3 sports_app.db .dump > sports_app_backup.sql
```

### 恢复数据
```bash
# 从备份文件恢复
cp sports_app_backup.db sports_app.db

# 从 SQL 文件恢复
sqlite3 new_sports_app.db < sports_app_backup.sql
```

## 注意事项

1. **文件权限**: 确保应用进程有数据库文件的读写权限
2. **备份策略**: 定期备份数据库文件
3. **并发限制**: SQLite 支持多读，但写操作会锁定整个数据库
4. **文件路径**: 生产环境中确保数据库文件路径正确

## 优势

- ✅ 零配置，无需安装数据库服务器
- ✅ 部署简单，只需复制文件
- ✅ 性能优秀，适合大多数Web应用
- ✅ 完整的SQL支持
- ✅ ACID事务保证
- ✅ 跨平台兼容性好
